// CVE-2021-44228 (Log4Shell) Directly Affected Entities
// This query identifies processes, services, and hosts directly affected by the Log4Shell vulnerability

fetch dt.entity.process_group
| fieldsAdd softwareTechnologies, runs_on, entity.name
| expand softwareTechnologies
| filter contains(softwareTechnologies, "LOG4J")
| filter contains(softwareTechnologies, "version:2.0") or 
        contains(softwareTechnologies, "version:2.1") or 
        contains(softwareTechnologies, "version:2.2") or 
        contains(softwareTechnologies, "version:2.3") or 
        contains(softwareTechnologies, "version:2.4") or 
        contains(softwareTechnologies, "version:2.5") or 
        contains(softwareTechnologies, "version:2.6") or 
        contains(softwareTechnologies, "version:2.7") or 
        contains(softwareTechnologies, "version:2.8") or 
        contains(softwareTechnologies, "version:2.9") or 
        contains(softwareTechnologies, "version:2.10") or 
        contains(softwareTechnologies, "version:2.11") or 
        contains(softwareTechnologies, "version:2.12") or 
        contains(softwareTechnologies, "version:2.13") or 
        contains(softwareTechnologies, "version:2.14")
| fieldsAdd id as process_group_id, entity.name as process_group_name, softwareTechnologies as log4j_version, runs_on
| sort process_group_name